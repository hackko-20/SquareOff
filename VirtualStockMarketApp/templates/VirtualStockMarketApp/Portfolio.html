{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="{% static 'CSS/Portfolio.css' %}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <title>Portfolio</title>
        <script>
        </script>
    </head>
    <body>
      <div>
        <!-- Top Navigation Menu -->
        <div class="topnav">
          <a href="portfolio" style="background:#4169E1;">Portfolio</a>
          <div id="myLinks" style="background: #4169E1;;">
            <a href="home">Explore Stocks</a>
            <a href="home">Home</a>
            <a href="logout">Log Out</a>
          </div>
          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
          </a>
        </div>
              
              <!-- End smartphone / tablet look -->
              </div>
              <script>                                    
                  function myFunction() {
                      var x = document.getElementById("myLinks");
                      if (x.style.display === "block") {
                        x.style.display = "none";
                      } else {
                        x.style.display = "block";
                      }
                    }
              </script>
        <div class="header">
            <div class="logo"></div>
            <div class="heading"><h1>Hello, Trader {{ user.first_name }}</h1></div>
        </div>
        <div class="accordion" id="accordionDisplay">
            <div class = "navbar">
                <ul class="nav">
                    <li class="nav-item" id="headingOne">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#NW" aria-expanded="true" aria-controls="NW">Profile</button>
                    </li>
                    <li class="nav-item" id="headingTwo">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#TH" aria-expanded="false" aria-controls="TH">Transaction History</button>
                    </li>
                    <li class="nav-item" id="headingThree"></li>
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#PL" aria-expanded="false" aria-controls="PL">Profit/Loss Statement</button>
                    </li>
                    <li class="nav-item" id="headingFour">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#FV" aria-expanded="false" aria-controls="FV">Favourites</button>
                    </li>
                    <li class="nav-item" id="headingFive">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#stocksOwned" aria-expanded="false" aria-controls="stocksOwned">Your Stock Holdings</button>
                    </li>   
                </ul>
                <div class="ExploreButton"><a href="explore">Go To Explore Menu!</a></div>
            </div>
            <div class = "mainContent">
                <!--Profile section -->
                <div class = "networth collapse show" aria-labelledby="headingOne" data-parent="#accordionDisplay" id="NW">
                    <div class = "profile">
                        <div class = "insights">
                            <h3>Your Trading Insights</h3><br><br>
                            <p>Net Worth :</p><span style="color: #4bf561;float:right;"><strong>&#36;{{ net_worth }}</strong></span><br>
                            <p>Overall Gain/Loss:</p>{% if net_worth|add:"-1000000" >= 0 %}<span style="color: #4bf561;float:right;"><strong>&#36;{{ net_worth|add:"-1000000" }}</strong></span><br>
                            {% else %}<span style="color: #eb5e4c;float:right;"><strong>&#36;{{ net_worth|add:"-1000000" }}</strong></span><br>
                            {% endif %}
                            <p>Today's Gain/Loss:</p><span style="color: #4bf561;float:right"><strong> &#36;</strong></span><br>
                        </div>
                        <div class = "personalGraph"> 
                            <h3>Your Status : Month </h3>
                            <p>Graph comes here</p>
                        </div>
                    </div>
                </div>

                <!-- Transaction History section -->
                <div class="transactHistory collapse" aria-labelledby="headingTwo" data-parent="#accordionDisplay" id="TH">
                    <h3>Transaction history</h3><br><br>
                    <table class="table table-striped table-dark table-sm tableHistory">
                        <thead>
                          <tr>
                            <th scope="col" class="columnHeads" style="padding:7px;">#</th>
                            <th scope="col" class="columnHeads" style="padding:7px;">Stock Symbol</th>
                            <th scope="col" class="columnHeads" style="padding:7px;">Bought/Sold</th>
                            <th scope="col" class="columnHeads" style="padding:7px;">Quantity</th>
                            <th scope="col" class="columnHeads" style="padding:7px;">Share Price</th>
                          </tr>
                        </thead>
                        <tbody>
                            {% for txn in user_transact_history %}
                          <tr>
                            <th scope="row" id="rowNum"></th>
                            <td>{{ txn.stock_symbol }}</td>
                            {% if txn.bought == True %}
                            <td style="color: #18f035;font-weight: 600;">Bought</td>
                            {% else %}
                            <td style="color: #e7a108;font-weight: 600;">Sold</td>
                            {% endif %}
                            <td>{{ txn.quantity }}</td>
                            <td>{{ txn.share_price }}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                </div>

                <!-- Profit section -->
                <div class="profit collapse" aria-labelledby="headingThree" data-parent="#accordionDisplay" id="PL">
                    <h3>Profit/Loss Statement: </h3><br>
                    <h5>Overall Gain:&nbsp;&nbsp;{% if net_worth|add:"-1000000" >= 0 %}<span style="color: #4bf561;"><strong>&#36;{{ net_worth|add:"-1000000" }}</strong></span><br>
                        {% else %}<span style="color: #eb5e4c;"><strong>&#36;{{ net_worth|add:"-1000000" }}</strong></span><br>
                        {% endif %}</h5>
                    <h5>Today's Gain: &#36; 0</h5>
                </div>

                <!--Stocks owned-->
                <div class="stocksOwned collapse" aria-labelledby="headingFive" data-parent="#accordionDisplay" id="stocksOwned">
                  <h3>Current Stock Holdings: </h3>
                  <table class="table table-striped table-dark tableStocks">
                    <thead>
                      <tr>
                        <th scope="col" class="columnHeads" style="padding:7px;">#</th>
                        <th scope="col" class="columnHeads" style="padding:7px;">Stock Symbol</th>
                        <th scope="col" class="columnHeads" style="padding:7px;">Quantity</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for row in user_stocks_owned %}
                      <tr>
                        <th scope="row"></th>
                        <td>{{ row.stock_symbol }}</td>
                        <td>{{ row.quantity }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>

                <!-- Favourites -->
                <div class = "favourites collapse" aria-labelledby="headingFour" data-parent="#accordionDisplay" id="FV">
                    <h3>Favourites</h3><br><br>
                    <table class="table table-striped table-dark table-sm tableHistory">
                        <thead>
                          <tr>
                            <th scope="col" class="columnHeads" style="padding:7px;">#</th>
                            <th scope="col" class="columnHeads" style="padding:7px;">Stock Symbol</th>
                            <th scope="col" class="columnHeads" style="padding:7px;">Current Share Price</th>
                          </tr>
                        </thead>
                        <tbody>
                            {% for favStocks in user_favourites %}
                            <script type="text/javascript">
                                let api_key = "pk_245073c85596466aa6afff012f007125";
                                var symbol = "{{ favStocks.stock_symbol }}";
                                console.log(symbol);
                                let url = "https://cloud.iexapis.com/" + "stable/stock/" + symbol + "/quote?token=" + api_key;
                                fetch(url)
                                    .then(response => response.json())
                                    .then(data => {
                                            console.log("in data");
                                            var x=data.latestPrice;
                                            document.getElementById("stock_symbolCol").innerHTML = " " + x + " ";
                                    })
                                    .catch(error => {
                                        alert("stock symbol not found");
                                    });
                            </script>
                            <tr>
                                <th scope="row"></th>
                                <td>{{ favStocks.stock_symbol }}</td>
                                <td id="stock_symbolCol"></td>
                            </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                </div>
            </div>
        </div>
    </body>
</html>